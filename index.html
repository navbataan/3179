<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Green Space vs Population Density for Melbourne (2024)</title>

  <!-- Pure.css (core + responsive grid) -->
  <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/pure-min.css" integrity="sha384-erTH6Y6NQJZbT3Q2n0k8hcb6o2d3tI6Wg1PX5o0h1PP6NnX5o3m4q7QfykpX4wsm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/grids-responsive-min.css">

  <!-- Vega, Vega-Lite, Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    :root{
      --bg:#0e0f12;        /* subtle dark backdrop (plays nicely with your inspiration) */
      --panel:#ffffff;
      --ink:#1a1a1a;
      --ink-sub:#555;
      --accent:#2f855a;    /* soft green accent */
      --radius:16px;
      --shadow:0 10px 24px rgba(0,0,0,.12);
    }

    body{ background:var(--bg); color:#111; font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; margin:0; }
    .wrap{ max-width:1120px; margin:0 auto; padding:24px 16px 80px; }

    /* Header */
    .hero{
      background:linear-gradient(180deg, #1a202c 0%, #0e0f12 100%);
      border-radius:var(--radius);
      padding:28px 24px;
      margin:0 0 24px;
      color:#fff;
      box-shadow:var(--shadow);
    }
    .hero h1{ margin:0 0 6px; font-size:2rem; letter-spacing:.2px; }
    .hero p{ margin:.25rem 0 0; color:#d0d4db; }

    /* Card container for every two-column block */
    .card{
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      margin:0 0 24px;
    }

    /* Text side */
    .textbox h2{ margin:0 0 8px; color:var(--ink); }
    .textbox p{ color:var(--ink-sub); margin:8px 0; }
    .kicker{ text-transform:uppercase; letter-spacing:.08em; color:var(--accent); font-weight:700; font-size:.78rem; }

    /* Chart containers (so Vega-Embed fills them nicely) */
    .chart{
      width:100%;
      min-height:360px;
      border-radius:12px;
      overflow:hidden;
      background:#fafafa;
      border:1px solid #eee;
    }

    /* Small helper to place two charts side-by-side inside one column */
    .twins{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width: 640px){ .twins{ grid-template-columns:1fr; } }

    /* Footer notes */
    .small{ font-size:.86rem; color:#999; }
    a{ color:#2463eb; text-decoration:none; }
    a:hover{ text-decoration:underline; }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Title / Intro -->
    <header class="hero">
      <h1>Green Space vs. Population Density in Melbourne & Surrounds (2024)</h1>
      <p>Exploring how access to green space varies across metropolitan Melbourne and nearby LGAs, and how that relates to population density.</p>
    </header>

    <!-- SECTION 1: Map (hero). Two-column: map + context -->
    <section class="card">
      <div class="pure-g">
        <div class="pure-u-1 pure-u-md-1-2" style="padding:6px;">
          <div id="chart-map" class="chart" aria-label="Choropleth/Proportional map"></div>
        </div>
        <div class="pure-u-1 pure-u-md-1-2 textbox" style="padding:6px;">
          <div class="kicker">1 · Where are we?</div>
          <h2>Melbourne"s Green Space at a Glance</h2>
          <p>Use this map to orient yourself. Darker tones indicate higher population density; circle size/colour (or choropleth, depending on your spec) encode green space share by LGA. Hover or tap to see the exact values.</p>
          <p>This establishes the spatial context before we dive into relationships and distributions.</p>
        </div>
      </div>
    </section>

    <!-- SECTION 2: Relationship (scatter). Text + chart -->
    <section class="card">
      <div class="pure-g">
        <div class="pure-u-1 pure-u-md-1-2 textbox" style="padding:6px;">
          <div class="kicker">2 · Relationship</div>
          <h2>Do Denser Areas Have Less Green?</h2>
          <p>The scatter plot relates <em>population density</em> (x) to <em>green space %</em> (y) for each LGA. A fitted line or LOESS (optional) can help reveal the overall trend.</p>
          <p>Look for clusters (inner-city vs outer suburbs), leverage points, and heteroscedasticity (spread changing with density). This frames the key narrative tension.</p>
        </div>
        <div class="pure-u-1 pure-u-md-1-2" style="padding:6px;">
          <div id="chart-scatter" class="chart" aria-label="Scatter plot"></div>
        </div>
      </div>
    </section>

    <!-- SECTION 3: Extremes (top/bottom lists). Graphs side-by-side in the LEFT column -->
    <section class="card">
      <div class="pure-g">
        <div class="pure-u-1 pure-u-md-1-2" style="padding:6px;">
          <div class="twins">
            <div id="chart-bars-top" class="chart" aria-label="Top LGAs by green space (bar)"></div>
            <div id="chart-bars-bottom" class="chart" aria-label="Bottom LGAs by green space (bar)"></div>
          </div>
        </div>
        <div class="pure-u-1 pure-u-md-1-2 textbox" style="padding:6px;">
          <div class="kicker">3 · Who has the most vs least?</div>
          <h2>Leaders & Laggards</h2>
          <p>Side-by-side horizontal bars spotlight the LGAs with the highest and lowest green space. Pair this with annotations calling out notable outliers or policy-relevant cases.</p>
          <p>If you prefer, stack these two bar charts vertically on small screens (this template already does that automatically).</p>
        </div>
      </div>
    </section>

    <!-- SECTION 4: Distribution (box + histogram). Charts stacked inside LEFT column -->
    <section class="card">
      <div class="pure-g">
        <div class="pure-u-1 pure-u-md-1-2" style="padding:6px;">
          <div class="twins" style="grid-template-columns:1fr; gap:12px;">
            <div id="chart-box" class="chart" aria-label="Box plot distribution"></div>
            <div id="chart-hist" class="chart" aria-label="Histogram distribution"></div>
          </div>
        </div>
        <div class="pure-u-1 pure-u-md-1-2 textbox" style="padding:6px;">
          <div class="kicker">4 · How is it distributed?</div>
          <h2>Spread, Skew & Typical Values</h2>
          <p>The box plot summarises median and spread of green space across LGAs; the histogram shows the shape (e.g., skew towards lower or higher shares). This helps conclude the story with a population-level view.</p>
          <p class="small">Data source credits and notes can go here. Replace this text with your own citations or methodology bullets.</p>
        </div>
      </div>
    </section>

    <p class="small" style="text-align:center;">Built with <a href="https://purecss.io/">Pure.css</a> and <a href="https://vega.github.io/vega-lite/">Vega-Lite</a>. Replace the sample text and paste your specs below.</p>
  </div>

  <script>
    // ============================
    // Paste your Vega-Lite specs
    // ============================
    // Example:
    // const MAP_SPEC = { "$schema":"https://vega.github.io/schema/vega-lite/v5.json", ... };

    const MAP_SPEC      = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 700,
  "title": {
    "text": "Melbourne and Surroundings: Population Density and Green Space (2024)",
    "subtitle": "Choropleth = population density (people/km²), Circles = green space (%)",
    "fontSize": 20,
    "anchor": "middle",
    "offset": 10
  },

  "projection": {
    "type": "mercator",
    "center": [145.0, -37.5], 
    "scale": 55000,             
    "translate": [400, 50]
  },

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/navbataan/3179/main/green_space_vic.json",
        "format": {"type": "topojson", "feature": "green_space_vic"}
      },
      "transform": [{"filter": "datum.properties.state_name_2021 == 'Victoria'"}],
      "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.5},
      "encoding": {
        "color": {
          "field": "properties.pop_density_2024_people_per_km2",
          "type": "quantitative",
          "title": "Population Density (people/km²)",
          "scale": {"scheme": "blues"}
        },
        "tooltip": [
          {"field": "properties.lga_name_2024", "title": "Local Government Area"},
          {
            "field": "properties.pop_density_2024_people_per_km2",
            "title": "Population Density (people/km²)",
            "format": ".0f"
          }
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids.csv"
      },
      "transform": [{"filter": "datum.state_name == 'Victoria'"}],
      "mark": {
        "type": "circle",
        "color": "darkgreen",
        "stroke": "white",
        "strokeWidth": 0.7,
        "opacity": 0.75
      },
      "encoding": {
        "longitude": {"field": "X", "type": "quantitative"},
        "latitude": {"field": "Y", "type": "quantitative"},
        "size": {
          "field": "Green_Pct",
          "type": "quantitative",
          "title": "Green Space (%)",
          "scale": {"domain": [0, 100], "range": [30, 1500]},
          "legend": {"symbolFillColor": "darkgreen"}
        },
        "tooltip": [
          {"field": "lga_name_2", "title": "Local Government Area"},
          {"field": "Green_Pct", "title": "Green Space (%)", "format": ".1f"}
        ]
      }
    }
  ],

  "config": {
    "background": "white",
    "view": {"stroke": "transparent"},
    "legend": {"titleFontSize": 12, "labelFontSize": 10, "orient": "right"}
  }
};
    const SCATTER_SPEC  = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Green Space (%) vs Population Density (people/km²) for Victoria LGAs",
    "subtitle": "Each dot represents a Victorian Local Government Area (2024)",
    "fontSize": 18,
    "anchor": "middle"
  },
  "width": 700,
  "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"
  },
  "params": [
    {
      "name": "Region",
      "bind": {
        "input": "select",
        "options": ["All", "Metropolitan", "Regional"],
        "labels": ["All Victoria", "Metropolitan", "Regional"],
        "name": "Filter by Region: "
      },
      "value": "All"
    }
  ],
  "transform": [
    {
      "filter": "Region == 'All' || datum.Region == Region"
    }
  ],
  "layer": [
    {
      "mark": {
        "type": "circle",
        "color": "#006400",
        "opacity": 0.75,
        "size": 250
      },
      "encoding": {
        "x": {
          "field": "pop_densit",
          "type": "quantitative",
          "title": "Population Density (people/km²)",
          "scale": {"type": "linear"},
          "axis": {"grid": true}
        },
        "y": {
          "field": "Green_Pct",
          "type": "quantitative",
          "title": "Green Space (%)",
          "axis": {"grid": true}
        },
        "tooltip": [
          {"field": "lga_name_2", "title": "Local Government Area"},
          {"field": "pop_densit", "title": "Population Density (people/km²)", "format": ".0f"},
          {"field": "Green_Pct", "title": "Green Space (%)", "format": ".1f"},
          {"field": "Region", "title": "Region"}
        ]
      }
    },
    {
      "mark": {"type": "rule", "color": "grey", "strokeDash": [4, 4], "size": 2},
      "encoding": {
        "y": {"datum": 20},
        "tooltip": {"value": "Approximate average green space (20%)"}
      }
    },
    {
      "mark": {
        "type": "text",
        "text": "Average green space ~20%",
        "color": "grey",
        "fontSize": 12,
        "align": "left",
        "dx": 5,
        "dy": -5
      },
      "encoding": {
        "x": {"datum": 50},
        "y": {"datum": 20}
      }
    }
  ],
  "config": {
    "background": "white",
    "view": {"stroke": "transparent"},
    "axis": {"titleFontSize": 13, "labelFontSize": 11}
  }
};
    const BARS_TOP_SPEC = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Top and Bottom Victorian LGAs by Green Space (%)",
    "subtitle": "Grouped by population density category (2024)",
    "anchor": "start",
    "fontSize": 16
  },
  "width": 500,
  "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"
  },
  "transform": [
    {
      "calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'",
      "as": "Density_Group"
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "Green_Pct", "order": "descending"}]
    },
    {
      "filter": "datum.rank <= 10 || datum.rank >= (datum.total - 10)"
    }
  ],
  "mark": {
    "type": "bar",
    "opacity": 1.0
  },
  "encoding": {
    "y": {
      "field": "lga_name_2",
      "type": "ordinal",
      "sort": "-x",
      "title": "Local Government Area",
      "axis": {"labelFontSize": 10}
    },
    "x": {
      "field": "Green_Pct",
      "type": "quantitative",
      "title": "Green Space (%)",
      "axis": {"grid": true}
    },
    "color": {
      "field": "Density_Group",
      "type": "nominal",
      "title": "Density Category",
      "scale": {"range": ["#e8f5e9", "#81c784", "#1b5e20"]}
    },
    "tooltip": [
      {"field": "lga_name_2", "title": "LGA"},
      {"field": "Green_Pct", "title": "Green Space (%)", "format": ".1f"},
      {"field": "pop_densit", "title": "Population Density (people/km²)", "format": ",.0f"},
      {"field": "Density_Group", "title": "Density Category"}
    ]
  }
};

    const BARS_BOT_SPEC = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {
    "text": "Top & Bottom Victorian LGAs by Population Density (people/km^2)",
    "subtitle": "Grouped by population density category (2024)",
    "anchor": "start",
    "fontSize": 16
  },
  "width": 500,
  "height": 500,
  "data": {
    "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"
  },
  "transform": [
    {
      "calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'",
      "as": "Density_Group"
    },
    {
      "window": [{"op": "rank", "as": "rank"}],
      "sort": [{"field": "pop_densit", "order": "descending"}]
    },
    {
      "filter": "datum.rank <= 10 || datum.rank >= (datum.total - 10)"
    }
  ],
  "mark": {
    "type": "bar",
    "opacity": 1.0
  },
  "encoding": {
    "y": {
      "field": "lga_name_2",
      "type": "ordinal",
      "sort": "-x",
      "title": "Local Government Area",
      "axis": {"labelFontSize": 10}
    },
    "x": {
      "field": "pop_densit",
      "type": "quantitative",
      "title": "Population Density (people/km^2)",
      "axis": {"grid": true}
    },
    "color": {
      "field": "Density_Group",
      "type": "nominal",
      "title": "Density Category",
      "scale": {"range": ["#e8f5e9", "#81c784", "#1b5e20"]}
    },
    "tooltip": [
      {"field": "lga_name_2", "title": "LGA"},
      {"field": "Green_Pct", "title": "Green Space (%)", "format": ".1f"},
      {"field": "pop_densit", "title": "Population Density (people/km²)", "format": ",.0f"},
      {"field": "Density_Group", "title": "Density Category"}
    ]
  }
};
    const BOX_SPEC      = {
    "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
    "title": "Green Space Distribution by Density Group (Victoria, 2024)",
    "data": {
      "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"
    },
    "transform": [
      {"filter": "datum.state_name == 'Victoria'"},
      {"filter": "isValid(datum.Green_Pct) && datum.Green_Pct > 0"},
      {
        "calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'",
        "as": "Density_Group"
      }
    ],
    "encoding": {
      "y": {
        "field": "Density_Group",
        "type": "nominal",
        "title": "Density Category",
        "sort": ["Low Density", "Medium Density", "High Density"]
      }
    },
    "layer": [
      {
        "transform": [
          {
            "aggregate": [
              {"op": "q1", "field": "Green_Pct", "as": "q1"},
              {"op": "q3", "field": "Green_Pct", "as": "q3"},
              {"op": "min", "field": "Green_Pct", "as": "lower"},
              {"op": "max", "field": "Green_Pct", "as": "upper"},
              {"op": "median", "field": "Green_Pct", "as": "median"}
            ],
            "groupby": ["Density_Group"]
          }
        ],
        "mark": {"type": "rule", "strokeWidth": 1},
        "encoding": {
          "x": {"field": "lower", "type": "quantitative", "title": "Green Space (%)"},
          "x2": {"field": "upper"},
          "color": {
            "field": "Density_Group",
            "type": "nominal",
            "scale": {"scheme": "set2"},
            "legend": null
          },
          "tooltip": [
            {"field": "Density_Group", "title": "Density Category"},
            {"field": "lower", "title": "Min (%)", "format": ".1f"},
            {"field": "upper", "title": "Max (%)", "format": ".1f"},
            {"field": "median", "title": "Median (%)", "format": ".1f"}
          ]
        }
      },
      {
        "transform": [
          {
            "aggregate": [
              {"op": "q1", "field": "Green_Pct", "as": "q1"},
              {"op": "q3", "field": "Green_Pct", "as": "q3"}
            ],
            "groupby": ["Density_Group"]
          }
        ],
        "mark": {"type": "bar", "size": 14, "stroke": "black", "strokeWidth": 0.5},
        "encoding": {
          "x": {"field": "q1", "type": "quantitative"},
          "x2": {"field": "q3"},
          "color": {
            "field": "Density_Group",
            "type": "nominal",
            "scale": {"scheme": "set2"},
            "legend": null
          },
          "tooltip": [
            {"field": "Density_Group", "title": "Density Category"},
            {"field": "q1", "title": "Q1 (25th %)", "format": ".1f"},
            {"field": "q3", "title": "Q3 (75th %)", "format": ".1f"}
          ]
        }
      },
      {
        "transform": [
          {
            "aggregate": [
              {"op": "median", "field": "Green_Pct", "as": "median"}
            ],
            "groupby": ["Density_Group"]
          }
        ],
        "mark": {"type": "tick", "color": "white", "size": 14},
        "encoding": {
          "x": {"field": "median", "type": "quantitative"},
          "tooltip": [
            {"field": "Density_Group", "title": "Density Category"},
            {"field": "median", "title": "Median (%)", "format": ".1f"}
          ]
        }
      },
      {
        "transform": [
          {
            "aggregate": [
              {"op": "q1", "field": "Green_Pct", "as": "q1"},
              {"op": "q3", "field": "Green_Pct", "as": "q3"},
              {"op": "stdev", "field": "Green_Pct", "as": "sd"}
            ],
            "groupby": ["Density_Group"]
          },
          {
            "calculate": "datum.q3 + 1.5 * datum.sd",
            "as": "upperFence"
          },
          {
            "calculate": "datum.q1 - 1.5 * datum.sd",
            "as": "lowerFence"
          }
        ],
        "mark": {
          "type": "point",
          "filled": true,
          "color": "black",
          "opacity": 0.7,
          "size": 40
        },
        "encoding": {
          "x": {"field": "upperFence", "type": "quantitative"},
          "tooltip": [
            {"field": "Density_Group", "title": "Density Category"},
            {"field": "upperFence", "title": "Upper Fence (approx.)", "format": ".1f"},
            {"field": "lowerFence", "title": "Lower Fence (approx.)", "format": ".1f"}
          ]
        }
      }
    ],
    "width": 450,
    "height": 400,
    "config": {
      "view": {"stroke": "transparent"},
      "axis": {"labelFontSize": 10, "titleFontSize": 11}
    }
  };
    const HIST_SPEC     = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "Distribution of Green Space Across Victorian LGAs"},
  "data": {"url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"},
  "transform": [{"filter": "datum.state_name == 'Victoria'"}],
  "mark": "bar",
  "encoding": {
    "x": {"bin": true, "field": "Green_Pct", "title": "Green Space (%)"},
    "y": {"aggregate": "count", "title": "Number of LGAs"},
    "color": {"value": "#388e3c"}
  },
  "width": 600,
  "height": 400
};

    // Common embed options
    const opts = { actions:false, renderer:"canvas", tooltip:true };

    // Render charts (only if a spec is provided)
    const tryEmbed = (el, spec) => {
      if (spec && Object.keys(spec).length){
        vegaEmbed(el, spec, opts).catch(console.error);
      } else {
        // Light placeholder if spec not yet added
        const node = document.querySelector(el);
        if (node){
          node.style.display = "grid";
          node.style.placeItems = "center";
          node.style.color = "#888";
          node.style.fontSize = "14px";
          node.style.background = "#f6f8fb";
          node.innerHTML = "Paste your Vega-Lite spec in <code>" + el.replace('#','').toUpperCase() + "</code>";
        }
      }
    };

    tryEmbed("#chart-map", MAP_SPEC);
    tryEmbed("#chart-scatter", SCATTER_SPEC);
    tryEmbed("#chart-bars-top", BARS_TOP_SPEC);
    tryEmbed("#chart-bars-bottom", BARS_BOT_SPEC);
    tryEmbed("#chart-box", BOX_SPEC);
    tryEmbed("#chart-hist", HIST_SPEC);
  </script>
</body>
</html>
