<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Green Space vs Population Density for Melbourne (2024)</title>

  <!-- Pure.css (base) -->
  <link rel="stylesheet" href="https://unpkg.com/purecss@3.0.0/build/pure-min.css" integrity="sha384-erTH6Y6NQJZbT3Q2n0k8hcb6o2d3tI6Wg1PX5o0h1PP6NnX5o3m4q7QfykpX4wsm" crossorigin="anonymous">

  <!-- Vega, Vega-Lite, Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    :root{
      --bg:#0e0f12;
      --panel:#ffffff;
      --ink:#1a1a1a;
      --ink-sub:#555;
      --accent:#2f855a;
      --radius:16px;
      --shadow:0 10px 24px rgba(0,0,0,.12);
      --page-max: 1000px; /* keeps boxes a bit narrower */
    }

    body{ background:var(--bg); color:#111; font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; margin:0; }
    .wrap{ max-width:var(--page-max); margin:0 auto; padding:24px 16px 80px; }

    /* Header */
    .hero{
      background:linear-gradient(180deg,#1a202c 0%,#0e0f12 100%);
      border-radius:var(--radius);
      padding:28px 24px;
      margin:0 0 32px;
      color:#fff;
      box-shadow:var(--shadow);
    }
    .hero h1{ margin:0 0 6px; font-size:2rem; letter-spacing:.2px; }
    .hero p{ margin:.25rem 0 0; color:#d0d4db; }

    /* Card layout: FLEX for true 2-column balance */
    .card{
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:32px 32px;
      margin:0 0 36px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:28px;
    }
    .card.reverse{ flex-direction:row-reverse; } /* alternate layout */

    /* Single-chart column */
    .chart{
      flex:1 1 52%;
      min-width:420px;
      min-height:360px;
      border-radius:12px;
      overflow:hidden;
      background:#fafafa;
      border:1px solid #eee;
    }

    /* A column that contains multiple charts (grid) */
    .charts{
      flex:1 1 52%;
      min-width:420px;
      display:grid;
      gap:16px;
    }
    .twins{ grid-template-columns:1fr 1fr; }       /* two side-by-side charts */
    .stack{ grid-template-columns:1fr; }           /* stacked charts */

    /* Text column */
    .textbox{
      flex:1 1 40%;
      min-width:320px;
    }
    .textbox h2{ margin:0 0 8px; color:var(--ink); }
    .textbox p{ color:var(--ink-sub); margin:8px 0; }
    .kicker{ text-transform:uppercase; letter-spacing:.08em; color:var(--accent); font-weight:700; font-size:.78rem; }

    /* Centered text helper (for section 3 caption) */
    .center-text{
      text-align:center;
      max-width:70ch;
      margin:8px auto 0;
      color:var(--ink-sub);
    }
    .center-text h2{ color:var(--ink); margin:6px 0; }

    .small{ font-size:.86rem; color:#999; }
    a{ color:#2463eb; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* Metadata "tab" */
    details.meta{
      background:var(--panel);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px 22px;
    }
    details.meta summary{
      list-style:none; cursor:pointer; font-weight:700; color:#1f2937;
    }
    details.meta summary::-webkit-details-marker{ display:none; }
  </style>
</head>
<body>
  <div class="wrap">

    <header class="hero">
      <h1>Green Space vs. Population Density in Melbourne & Surrounds (2024)</h1>
      <p>Exploring how access to green space varies across metropolitan Melbourne and nearby LGAs, and how that relates to population density.</p>
    </header>

    <!-- 1) MAP — chart left / text right -->
    <section class="card">
      <div class="chart" id="chart-map" aria-label="Choropleth/Proportional map"></div>
      <div class="textbox">
        <div class="kicker">1 · Where are we?</div>
        <h2>Melbourne’s Green Space at a Glance</h2>
        <p>This overview map compares <strong>population density</strong> (choropleth) with <strong>green space</strong> (circle size). Darker tones mark denser LGAs; larger circles indicate more green coverage.</p>
        <p>Notice the inner-metro LGAs clustering with darker shades and smaller circles, while outer-fringe LGAs show lighter shades with larger circles. This sets the spatial stage for the analysis that follows.</p>
      </div>
    </section>

    <!-- 2) SCATTER — text left / chart right -->
    <section class="card reverse">
      <div class="textbox">
        <div class="kicker">2 · Relationship</div>
        <h2>Do Denser Areas Have Less Green?</h2>
        <p>The scatter plots each LGA by <em>population density</em> (x-axis) and <em>green space share</em> (y-axis). A dashed guide marks ~20% green space.</p>
        <p>Overall, the cloud slopes downward: as density rises, green space tends to fall. Compare Metropolitan vs Regional using the dropdown—outer-suburban LGAs usually sit above the line, while inner-city LGAs sit below.</p>
      </div>
      <div class="chart" id="chart-scatter" aria-label="Scatter plot"></div>
    </section>

    <!-- 3) RANKINGS — two bar charts side-by-side, caption centered below -->
    <section class="card">
      <div class="charts twins" aria-label="Two bar charts">
        <div class="chart" id="chart-bars-top" aria-label="Top LGAs by green space (bar)"></div>
        <div class="chart" id="chart-bars-bottom" aria-label="Top & Bottom LGAs by population density (bar)"></div>
      </div>
      <div class="center-text">
        <div class="kicker">3 · Who stands out?</div>
        <h2>Leaders & Laggards</h2>
        <p>The left chart lists LGAs with the <strong>highest green-space percentages</strong>. The right chart highlights LGAs with the <strong>highest population densities</strong>. Together they show where green amenity and density align—or don’t. Use these lists to identify possible equity or planning priorities.</p>
      </div>
    </section>

    <!-- 4) DISTRIBUTION — box + histogram stacked in one column -->
    <section class="card reverse">
      <div class="textbox">
        <div class="kicker">4 · How is it distributed?</div>
        <h2>Spread, Skew & Typical Values</h2>
        <p>The box plot summarises the <em>median</em> and <em>spread</em> of green space within low, medium and high-density groups, indicating wider variability at the fringes and tighter ranges in denser cores.</p>
        <p>The histogram shows the overall shape across all LGAs—where most places sit, and whether we see a long tail of very green or very built-up areas.</p>
        <p class="small">Data sources: ABS & Victorian open data (2024). Calculations by author.</p>
      </div>
      <div class="charts stack">
        <div class="chart" id="chart-box" aria-label="Box plot distribution"></div>
        <div class="chart" id="chart-hist" aria-label="Histogram distribution"></div>
      </div>
    </section>

    <!-- Metadata tab -->
    <details class="meta">
      <summary>Metadata & Methods</summary>
      <div style="margin-top:10px; color:#555;">
        <p><strong>Datasets.</strong> Victorian LGA boundaries (TopoJSON), ABS population density, curated LGA centroids with derived green-space %.</p>
        <p><strong>Processing.</strong> Joined attributes by LGA, computed percent green space, exported CSV/TopoJSON. Choropleth uses sequential “blues”; bubbles scale by green-space %.</p>
        <p><strong>Notes.</strong> 2024 estimates; boundary differences across sources may introduce small discrepancies.</p>
      </div>
    </details>

    <p class="small" style="text-align:center; margin-top:18px;">Built with Pure.css and Vega-Lite.</p>
  </div>

  <script>
    /* Base helper: make every spec fill its container, and center titles */
    const withBase = (spec) => {
      const baseConfig = {
        title: { anchor: "middle", fontSize: 14, fontWeight: 600 },   // smaller + centered
        legend: { orient: "bottom", direction: "horizontal" },
        view: { stroke: "transparent" }
      };
      return {
        autosize: { type: "fit", contains: "padding" },
        width: "container",
        ...spec,
        config: { ...baseConfig, ...(spec.config || {}) }
      };
    };

    /* ====== SPECS (unchanged data sources; titles centered & smaller) ====== */

    const MAP_SPEC = withBase({
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "height": 520,
      "title": {
        "text": "Melbourne and Surroundings: Population Density and Green Space (2024)",
        "subtitle": "Choropleth = population density (people/km²), Circles = green space (%)",
        "fontSize": 14,      /* smaller title */
        "anchor": "middle",
        "offset": 8
      },
      "projection": { "type": "mercator" },
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/navbataan/3179/main/green_space_vic.json",
            "format": {"type": "topojson", "feature": "green_space_vic"}
          },
          "transform": [{"filter": "datum.properties.state_name_2021 == 'Victoria'"}],
          "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.5},
          "encoding": {
            "color": {
              "field": "properties.pop_density_2024_people_per_km2",
              "type": "quantitative",
              "title": "Population Density (people/km²)",
              "scale": {"scheme": "blues"},
              "legend": {"orient": "bottom", "direction": "horizontal"}
            },
            "tooltip": [
              {"field": "properties.lga_name_2024", "title": "Local Government Area"},
              {"field": "properties.pop_density_2024_people_per_km2", "title": "Population Density (people/km²)", "format": ".0f"}
            ]
          }
        },
        {
          "data": {"url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids.csv"},
          "transform": [{"filter": "datum.state_name == 'Victoria'"}],
          "mark": {"type": "circle", "color": "darkgreen", "stroke": "white", "strokeWidth": 0.7, "opacity": 0.75},
          "encoding": {
            "longitude": {"field": "X", "type": "quantitative"},
            "latitude": {"field": "Y", "type": "quantitative"},
            "size": {
              "field": "Green_Pct",
              "type": "quantitative",
              "title": "Green Space (%)",
              "scale": {"domain": [0, 100], "range": [30, 1500]},
              "legend": {"orient": "bottom", "direction": "horizontal", "symbolFillColor": "darkgreen"}
            },
            "tooltip": [
              {"field": "lga_name_2", "title": "Local Government Area"},
              {"field": "Green_Pct", "title": "Green Space (%)", "format": ".1f"}
            ]
          }
        }
      ]
    });

    const SCATTER_SPEC = withBase({
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "height": 420,
      "title": {
        "text": "Green Space (%) vs Population Density (people/km²) for Victoria LGAs",
        "subtitle": "Each dot represents a Victorian Local Government Area (2024)",
        "fontSize": 14,      /* smaller & centered */
        "anchor": "middle"
      },
      "data": { "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv" },
      "params": [
        {
          "name": "Region",
          "bind": {
            "input": "select",
            "options": ["All", "Metropolitan", "Regional"],
            "labels": ["All Victoria", "Metropolitan", "Regional"],
            "name": "Filter by Region: "
          },
          "value": "All"
        }
      ],
      "transform": [{ "filter": "Region == 'All' || datum.Region == Region" }],
      "layer": [
        {
          "mark": {"type": "circle", "color": "#006400", "opacity": 0.75, "size": 180},
          "encoding": {
            "x": {"field": "pop_densit", "type": "quantitative", "title": "Population Density (people/km²)", "axis": {"grid": true}},
            "y": {"field": "Green_Pct", "type": "quantitative", "title": "Green Space (%)", "axis": {"grid": true}},
            "tooltip": [
              {"field": "lga_name_2", "title": "Local Government Area"},
              {"field": "pop_densit", "title": "Population Density (people/km²)", "format": ".0f"},
              {"field": "Green_Pct", "title": "Green Space (%)", "format": ".1f"},
              {"field": "Region", "title": "Region"}
            ]
          }
        },
        { "mark": {"type": "rule", "color": "grey", "strokeDash": [4, 4], "size": 2}, "encoding": { "y": {"datum": 20} } },
        { "mark": {"type": "text", "text": "Average green space ~20%", "color": "grey", "fontSize": 12, "align": "left", "dx": 5, "dy": -5}, "encoding": { "x": {"datum": 50}, "y": {"datum": 20} } }
      ]
    });

    const BARS_TOP_SPEC = withBase({
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "height": 420,
      "title": {"text": "Top Victorian LGAs by Green Space (%)", "fontSize": 14, "anchor": "middle"},
      "data": { "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv" },
      "transform": [
        {"calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'", "as": "Density_Group"}
      ],
      "mark": {"type": "bar", "opacity": 1.0},
      "encoding": {
        "y": {"field": "lga_name_2", "type": "ordinal", "sort": "-x", "title": "Local Government Area", "axis": {"labelFontSize": 10}},
        "x": {"field": "Green_Pct", "type": "quantitative", "title": "Green Space (%)", "axis": {"grid": true}},
        "color": {
          "field": "Density_Group", "type": "nominal", "title": "Density Category",
          "scale": {"range": ["#e8f5e9", "#81c784", "#1b5e20"]},
          "legend": {"orient": "bottom", "direction": "horizontal"}
        }
      }
    });

    const BARS_BOT_SPEC = withBase({
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "height": 420,
      "title": {"text": "Top & Bottom Victorian LGAs by Population Density (people/km²)", "fontSize": 14, "anchor": "middle"},
      "data": { "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv" },
      "transform": [
        {"calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'", "as": "Density_Group"},
        {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "pop_densit", "order": "descending"}]},
        {"filter": "datum.rank <= 10 || datum.rank >= (datum.total - 10)"}
      ],
      "mark": {"type": "bar", "opacity": 1.0},
      "encoding": {
        "y": {"field": "lga_name_2", "type": "ordinal", "sort": "-x", "title": "Local Government Area", "axis": {"labelFontSize": 10}},
        "x": {"field": "pop_densit", "type": "quantitative", "title": "Population Density (people/km²)", "axis": {"grid": true}},
        "color": {
          "field": "Density_Group", "type": "nominal", "title": "Density Category",
          "scale": {"range": ["#e8f5e9", "#81c784", "#1b5e20"]},
          "legend": {"orient": "bottom", "direction": "horizontal"}
        }
      }
    });

    const BOX_SPEC = withBase({
      "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
      "height": 360,
      "title": {"text":"Green Space Distribution by Density Group (Victoria, 2024)","fontSize":14,"anchor":"middle"},
      "data": { "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv" },
      "transform": [
        {"filter": "datum.state_name == 'Victoria'"},
        {"filter": "isValid(datum.Green_Pct) && datum.Green_Pct > 0"},
        {"calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'", "as": "Density_Group"}
      ],
      "encoding": {
        "y": {"field": "Density_Group", "type": "nominal", "title": "Density Category", "sort": ["Low Density","Medium Density","High Density"]}
      },
      "layer": [
        { "transform": [{"aggregate":[{"op":"q1","field":"Green_Pct","as":"q1"},{"op":"q3","field":"Green_Pct","as":"q3"},{"op":"min","field":"Green_Pct","as":"lower"},{"op":"max","field":"Green_Pct","as":"upper"},{"op":"median","field":"Green_Pct","as":"median"}],"groupby":["Density_Group"]}], "mark": {"type":"rule","strokeWidth":1}, "encoding": { "x": {"field":"lower","type":"quantitative","title":"Green Space (%)"}, "x2":{"field":"upper"}, "color":{"field":"Density_Group","type":"nominal","scale":{"scheme":"set2"},"legend":null } } },
        { "transform": [{"aggregate":[{"op":"q1","field":"Green_Pct","as":"q1"},{"op":"q3","field":"Green_Pct","as":"q3"}],"groupby":["Density_Group"]}], "mark": {"type":"bar","size":14,"stroke":"black","strokeWidth":0.5}, "encoding": { "x":{"field":"q1","type":"quantitative"}, "x2":{"field":"q3"},"color":{"field":"Density_Group","type":"nominal","scale":{"scheme":"set2"},"legend":null } } },
        { "transform": [{"aggregate":[{"op":"median","field":"Green_Pct","as":"median"}],"groupby":["Density_Group"]}], "mark": {"type":"tick","color":"white","size":14}, "encoding": { "x":{"field":"median","type":"quantitative"} } },
        { "transform": [{"aggregate":[{"op":"q1","field":"Green_Pct","as":"q1"},{"op":"q3","field":"Green_Pct","as":"q3"},{"op":"stdev","field":"Green_Pct","as":"sd"}],"groupby":["Density_Group"]},{"calculate":"datum.q3 + 1.5 * datum.sd","as":"upperFence"},{"calculate":"datum.q1 - 1.5 * datum.sd","as":"lowerFence"}], "mark": {"type":"point","filled":true,"color":"black","opacity":0.7,"size":40}, "encoding": { "x":{"field":"upperFence","type":"quantitative"} } }
      ]
    });

    const HIST_SPEC = withBase({
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "height": 360,
      "title": {"text": "Distribution of Green Space Across Victorian LGAs", "fontSize": 14, "anchor":"middle"},
      "data": {"url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"},
      "transform": [{"filter": "datum.state_name == 'Victoria'"}],
      "mark": "bar",
      "encoding": {
        "x": {"bin": true, "field": "Green_Pct", "title": "Green Space (%)"},
        "y": {"aggregate": "count", "title": "Number of LGAs"},
        "color": {"value": "#388e3c"}
      }
    });

    /* Embed all charts */
    const opts = { actions:false, renderer:"canvas", tooltip:true };
    const embed = (sel, spec) => vegaEmbed(sel, spec, opts).catch(console.error);

    embed("#chart-map", MAP_SPEC);
    embed("#chart-scatter", SCATTER_SPEC);
    embed("#chart-bars-top", BARS_TOP_SPEC);
    embed("#chart-bars-bottom", BARS_BOT_SPEC);
    embed("#chart-box", BOX_SPEC);
    embed("#chart-hist", HIST_SPEC);
  </script>
</body>
</html>
