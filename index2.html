<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Victoria: Green Space and Population Density (2024)</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      margin: 0;
      background: #fafafa;
      color: #333;
      line-height: 1.7;
    }

    header {
      text-align: center;
      padding: 60px 20px 20px 20px;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 10px;
      font-weight: 600;
    }

    p.subtitle {
      color: #555;
      max-width: 800px;
      margin: 0 auto 40px auto;
      font-size: 1rem;
    }

    /* --- Layout container --- */
    .section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 40px;
      max-width: 1200px;
      margin: 0 auto 100px auto;
      padding: 0 40px;
    }

    .section.reverse { flex-direction: row-reverse; }

    .text {
      flex: 1;
      font-size: 1rem;
      color: #444;
    }

    .text h2 {
      color: #1b5e20;
      margin-bottom: 10px;
      font-size: 1.4rem;
    }

    .vis {
      flex: 1.1;
    }

    /* --- Responsive --- */
    @media (max-width: 900px) {
      .section, .section.reverse {
        flex-direction: column;
        text-align: center;
      }
      .text, .vis {
        width: 100%;
      }
      .vis {
        margin-top: 20px;
      }
    }

    .vis, .text {
      animation: fadein 1s ease;
    }

    @keyframes fadein {
      from {opacity: 0; transform: translateY(20px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>

<body>
  <header>
    <h1>Victoria: Green Space and Population Density (2024)</h1>
    <p class="subtitle">
      Exploring how population density and green space vary across Victorias Local Government Areas (LGAs),
      revealing patterns of urban development and environmental balance.
    </p>
  </header>

  <!-- === SECTION 1: MAP === -->
  <section class="section">
    <div class="text">
      <h2>Mapping Population Density and Green Space</h2>
      <p>
        The choropleth map highlights areas of high and low population density across Victoria.
        The darker shades indicate higher density. Circle size corresponds to the proportion of
        <b>green space (%)</b> available within each LGA.
      </p>
      <p>
        Metropolitan regions like Melbourne show higher density and limited vegetation,
        whereas regional areas remain greener with lower populations.
      </p>
    </div>
    <div class="vis" id="map"></div>
  </section>

  <!-- === SECTION 2: SCATTER === -->
  <section class="section reverse">
    <div class="text">
      <h2>Green Space vs. Population Density</h2>
      <p>
        Each point represents an LGA. The scatterplot shows an inverse correlation between
        population density and green space availability, denser areas tend to have less vegetation.
      </p>
      <p>
        The dotted reference line marks the average statewide green space (~20%),
        helping highlight which LGAs exceed or fall below the mean.
      </p>
    </div>
    <div class="vis" id="scatter"></div>
  </section>

  <!-- === SECTION 3: BAR CHARTS SIDE BY SIDE === -->
  <section class="section">
    <div class="text">
      <h2>Comparing Green Space and Density Rankings</h2>
      <p>
        These charts rank LGAs by <b>green space percentage</b> and by <b>population density</b>.
        The contrast clearly illustrates how urbanisation affects greenery across regions.
      </p>
    </div>
    <div class="vis" style="display:flex;gap:20px;flex-wrap:wrap;">
      <div id="bar" style="flex:1;min-width:380px;"></div>
      <div id="density" style="flex:1;min-width:380px;"></div>
    </div>
  </section>

  <!-- === SECTION 4: BOX PLOT === -->
  <section class="section reverse">
    <div class="text">
      <h2>Distribution by Density Category</h2>
      <p>
        The boxplot shows the variation in green space percentages within each density group.
        Low-density LGAs show a much higher median and wider spread of green areas.
      </p>
    </div>
    <div class="vis" id="box"></div>
  </section>

  <footer style="text-align:center; padding:40px; color:#777; font-size:0.85rem;">
    Data: ABS, VicMap 2024 | Visualisations by Navneet Bataan
  </footer>

  <script>
    const mapSpec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 'container',
  "height": 700,
  "title": {
    "text": "Melbourne and Surroundings: Population Density and Green Space (2024)",
    "subtitle": "Choropleth = population density (people/km²), Circles = green space (%)",
    "fontSize": 20,
    "anchor": "middle",
    "offset": 10
  },

  "projection": {
    "type": "mercator",
    "center": [145.0, -37.5], 
    "scale": 55000,             
    "translate": [400, 50]
  },

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/navbataan/3179/main/green_space_vic.json",
        "format": {"type": "topojson", "feature": "green_space_vic"}
      },
      "transform": [{"filter": "datum.properties.state_name_2021 == 'Victoria'"}],
      "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.5},
      "encoding": {
        "color": {
          "field": "properties.pop_density_2024_people_per_km2",
          "type": "quantitative",
          "title": "Population Density (people/km²)",
          "scale": {"scheme": "blues"}
        },
        "tooltip": [
          {"field": "properties.lga_name_2024", "title": "Local Government Area"},
          {
            "field": "properties.pop_density_2024_people_per_km2",
            "title": "Population Density (people/km²)",
            "format": ".0f"
          }
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids.csv"
      },
      "transform": [{"filter": "datum.state_name == 'Victoria'"}],
      "mark": {
        "type": "circle",
        "color": "darkgreen",
        "stroke": "white",
        "strokeWidth": 0.7,
        "opacity": 0.75
      },
      "encoding": {
        "longitude": {"field": "X", "type": "quantitative"},
        "latitude": {"field": "Y", "type": "quantitative"},
        "size": {
          "field": "Green_Pct",
          "type": "quantitative",
          "title": "Green Space (%)",
          "scale": {"domain": [0, 100], "range": [30, 1500]},
          "legend": {"symbolFillColor": "darkgreen"}
        },
        "tooltip": [
          {"field": "lga_name_2", "title": "Local Government Area"},
          {"field": "Green_Pct", "title": "Green Space (%)", "format": ".1f"}
        ]
      }
    }
  ],

  "config": {
    "background": "white",
    "view": {"stroke": "transparent"},
    "legend": {"titleFontSize": 12, "labelFontSize": 10, "orient": "right"}
  }
}
;

    const scatterSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Green Space (%) vs Population Density (people/km²) for Victoria LGAs",
        "subtitle": "Each dot represents a Victorian Local Government Area (2024)",
        "fontSize": 18,"anchor": "middle"},
      "width": '600',"height": 500,
      "data": {"url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"},
      "params": [{
        "name": "Region",
        "bind": {"input": "select","options": ["All","Metropolitan","Regional"],
                 "labels": ["All Victoria","Metropolitan","Regional"],
                 "name": "Filter by Region: "},
        "value": "All"
      }],
      "transform": [{"filter": "Region == 'All' || datum.Region == Region"}],
      "layer": [
        {
          "mark": {"type": "circle","color": "#2e7d32","opacity": 0.75,"size": 250},
          "encoding": {
            "x": {"field": "pop_densit","type": "quantitative",
              "title": "Population Density (people/km²)","scale": {"type": "linear"},"axis": {"grid": true}},
            "y": {"field": "Green_Pct","type": "quantitative","title": "Green Space (%)","axis": {"grid": true}},
            "tooltip": [
              {"field": "lga_name_2","title": "Local Government Area"},
              {"field": "pop_densit","title": "Population Density (people/km²)","format": ".0f"},
              {"field": "Green_Pct","title": "Green Space (%)","format": ".1f"},
              {"field": "Region","title": "Region"}
            ]
          }
        },
        {"mark": {"type": "rule","color": "#81c784","strokeDash": [4,4],"size": 2},
         "encoding": {"y": {"datum": 20}}},
        {"mark": {"type": "text","text": "Average green space ~20%","color": "#1b5e20",
                  "fontSize": 12,"align": "left","dx": 5,"dy": -5},
         "encoding": {"x": {"datum": 50},"y": {"datum": 20}}}
      ]
    };

    const barSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Top and Bottom Victorian LGAs by Green Space (%)",
        "subtitle": "Grouped by population density category (2024)",
        "anchor": "start","fontSize": 16},
      "width": 500,"height": 420,
      "data": {"url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"},
      "transform": [
        {"calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'",
         "as": "Density_Group"},
        {"window": [{"op": "rank","as": "rank"}],"sort": [{"field": "Green_Pct","order": "descending"}]},
        {"filter": "datum.rank <= 10 || datum.rank >= (datum.total - 10)"}
      ],
      "mark": {"type": "bar","opacity": 1.0},
      "encoding": {
        "y": {"field": "lga_name_2","type": "ordinal","sort": "-x","title": "Local Government Area",
              "axis": {"labelFontSize": 10}},
        "x": {"field": "Green_Pct","type": "quantitative","title": "Green Space (%)","axis": {"grid": true}},
        "color": {"field": "Density_Group","type": "nominal","title": "Density Category",
          "scale": {"range": ["#e8f5e9","#81c784","#1b5e20"]}},
        "tooltip": [
          {"field": "lga_name_2","title": "LGA"},
          {"field": "Green_Pct","title": "Green Space (%)","format": ".1f"},
          {"field": "pop_densit","title": "Population Density (people/km²)","format": ".0f"},
          {"field": "Density_Group","title": "Density Category"}
        ]
      }
    };
    
    const densitySpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Top & Bottom LGAs by Population Density (people/km²)", "fontSize": 16},
      "width": 420,
      "height": 400,
      "data": {"url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"},
      "transform": [
        {"filter": "datum.state_name == 'Victoria'"},
        {"filter": "isValid(datum.pop_densit) && datum.pop_densit > 0"},
        {
          "calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'",
          "as": "Density_Group"
        },
        {"window": [{"op": "rank", "as": "rank"}], "sort": [{"field": "pop_densit", "order": "descending"}]},
        {"filter": "datum.rank <= 10"}
      ],
      "mark": {"type": "bar", "cornerRadiusEnd": 3},
      "encoding": {
        "y": {"field": "lga_name_2", "type": "ordinal", "sort": "-x", "title": "LGA"},
        "x": {"field": "pop_densit", "type": "quantitative", "title": "Population Density (people/km²)"},
        "color": {"field": "Density_Group", "type": "nominal", "scale": {"range": ["#e8f5e9", "#81c784", "#1b5e20"]}},
        "tooltip": [
          {"field": "lga_name_2", "title": "LGA"},
          {"field": "pop_densit", "title": "Population Density", "format": ".0f"}
        ]
      },
      "config": {"axis": {"labelFontSize": 10, "titleFontSize": 11}}
    };

    const boxSpec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Green Space Distribution by Density Group (Victoria, 2024)"},
      "width": 450,"height": 400,
      "data": {"url": "https://raw.githubusercontent.com/navbataan/3179/main/centroids_clean.csv"},
      "transform": [
        {"calculate": "datum.pop_densit < 1000 ? 'Low Density' : datum.pop_densit < 3000 ? 'Medium Density' : 'High Density'",
         "as": "Density_Group"}
      ],
      "mark": "boxplot",
      "encoding": {
        "x": {"field": "Density_Group","type": "nominal","title": "Density Category"},
        "y": {"field": "Green_Pct","type": "quantitative","title": "Green Space (%)"},
        "color": {"field": "Density_Group","type": "nominal",
                  "scale": {"range": ["#e8f5e9","#81c784","#1b5e20"]}}
      }
    };

    vegaEmbed("#map", mapSpec, {actions:false});
    vegaEmbed("#scatter", scatterSpec, {actions:false});
    vegaEmbed("#bar", barSpec, {actions:false});
    vegaEmbed("#density", densitySpec, {actions:false});
    vegaEmbed("#box", boxSpec, {actions:false});
  </script>
</body>
</html>
